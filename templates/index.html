<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lørenskog Skytterlag</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Lørenskog Skytterlag Logo" class="header-logo">
                <span>Lørenskog Skytterlag</span>
            </h1>
                    <div class="header-controls">
            <button id="viewToggle" class="btn btn-secondary">
                <i class="fas fa-list"></i> Liste
            </button>
            <button id="adminBtn" class="btn btn-admin">
                <i class="fas fa-cog"></i>
            </button>
        </div>
        
        <!-- Admin Mode Controls (hidden by default) -->
        <div id="adminModeControls" class="admin-mode-controls hidden">
            <button id="addActivityBtnMain" class="btn btn-admin-action" title="Legg til ny aktivitet">
                <i class="fas fa-plus"></i>
            </button>
            <button id="importCalendarBtnMain" class="btn btn-admin-action" title="Last inn ekstern kalender">
                <i class="fas fa-download"></i>
            </button>
            <button id="checkDuplicatesBtnMain" class="btn btn-admin-action" title="Sjekk for duplikater">
                <i class="fas fa-search"></i>
            </button>
            <button id="deleteAllActivitiesBtnMain" class="btn btn-admin-action" title="Slett aktiviteter" style="background-color: #dc3545;">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
        </header>

        <!-- Filter Section -->
        <section class="filters">
            <div class="filter-header">
                <h3>Filtrer aktiviteter:</h3>
                <div class="filter-controls">
                    <button id="toggleFilters" class="btn btn-small btn-secondary">
                        <i class="fas fa-chevron-down"></i> Vis filtre
                    </button>
                    <button id="clearFilters" class="btn btn-small btn-secondary">
                        <i class="fas fa-times"></i> Fjern alle valg
                    </button>
                </div>
            </div>
            <div id="activityCounterMain" class="activity-counter-main hidden">
                <i class="fas fa-calendar-check"></i>
                <span>Lagrede aktiviteter: <span id="activityCountMain">0</span></span>
            </div>

            <div id="filterCheckboxes" class="filter-checkboxes collapsed">
                <label class="filter-item filter-switch">
                    <input type="checkbox" value="Utelat udefinert" checked>
                    <span class="switch-slider"></span>
                    Vis kun bekreftede
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="Åpen for alle" checked>
                    <span class="color-dot" style="background-color: #98FB98;"></span>
                    Åpen for alle
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="Jeger" checked>
                    <span class="color-dot" style="background-color: #228B22;"></span>
                    Jeger
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="DFS" checked>
                    <span class="color-dot" style="background-color: #8B4513;"></span>
                    DFS
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="Pistol" checked>
                    <span class="color-dot" style="background-color: #F59E0B;"></span>
                    Pistol
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="PRS" checked>
                    <span class="color-dot" style="background-color: #8B5CF6;"></span>
                    PRS
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="Leirdue" checked>
                    <span class="color-dot" style="background-color: #EC4899;"></span>
                    Leirdue
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="Storviltprøve" checked>
                    <span class="color-dot" style="background-color: #3B82F6;"></span>
                    Storviltprøve
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="Annet" checked>
                    <span class="color-dot" style="background-color: #6B7280;"></span>
                    Annet
                </label>

                <label class="filter-item">
                    <input type="checkbox" value="Uavklart" checked>
                    <span class="color-dot" style="background-color: #EF4444;"></span>
                    Uavklart
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="100m" checked>
                    <span class="color-dot" style="background-color: #87CEEB;"></span>
                    100m
                </label>
                <label class="filter-item">
                    <input type="checkbox" value="200m" checked>
                    <span class="color-dot" style="background-color: #4ECDC4;"></span>
                    200m
                </label>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <!-- List View -->
            <div id="listView" class="view active">
                <div class="list-container">
                    <!-- Items will be populated by JavaScript -->
                </div>
            </div>

            <!-- Calendar View -->
            <div id="calendarView" class="view">
                <div class="calendar-header">
                    <button id="prevMonth" class="btn btn-secondary">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h2 id="currentMonth">Januar 2024</h2>
                    <button id="nextMonth" class="btn btn-secondary">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-grid">
                    <!-- Calendar will be populated by JavaScript -->
                </div>
            </div>
        </main>

        <!-- Admin Modal -->
        <div id="adminModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Admin Panel</h2>
                    <button id="closeModal" class="btn-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="pinSection">
                        <h3>Skriv inn PIN-kode:</h3>
                        <input type="password" id="pinInput" maxlength="4" placeholder="0000">
                        <button id="submitPin" class="btn btn-primary">Logg inn</button>
                    </div>
                    <div id="adminPanel" class="hidden">
                        <div class="admin-header">
                            <h3>Admin Dashboard</h3>
                            <div class="activity-counter">
                                <small>Lagrede aktiviteter: <span id="activityCount">0</span></small>
                            </div>
                        </div>
                        
                        <!-- Admin Menu -->
                        <div class="admin-menu">
                            <button id="addActivityBtn" class="admin-menu-item active">
                                <i class="fas fa-plus"></i>
                                <span>Legg til ny aktivitet</span>
                            </button>
                            <button id="importCalendarBtn" class="admin-menu-item">
                                <i class="fas fa-download"></i>
                                <span>Last inn ekstern kalender</span>
                            </button>
                            <button id="checkDuplicatesBtn" class="admin-menu-item">
                                <i class="fas fa-search"></i>
                                <span>Sjekk for duplikater</span>
                            </button>

                        </div>
                        
                        <!-- Add Activity Panel -->
                        <div id="addActivityPanel" class="admin-panel active">
                            <h4>Legg til ny åpningstid</h4>
                            <form id="addForm">
                                <div class="form-group">
                                    <label for="date">Dato:</label>
                                    <input type="date" id="date" name="date" required lang="no" pattern="\d{4}-\d{2}-\d{2}">
                                </div>
                                <div class="form-group">
                                    <label for="startTime">Start tid (24-timers format):</label>
                                    <div class="time-input-container">
                                        <input type="number" id="startTimeHours" min="0" max="23" placeholder="14" class="time-hours" required>
                                        <span class="time-separator">:</span>
                                        <input type="number" id="startTimeMinutes" min="0" max="59" step="15" placeholder="30" class="time-minutes" required>
                                        <input type="hidden" id="startTime" name="startTime">
                                    </div>
                                    <small class="form-help">Minuttene må være hvert kvarter (00, 15, 30, 45)</small>
                                </div>
                                <div class="form-group">
                                    <label for="endTime">Slutt tid (24-timers format):</label>
                                    <div class="time-input-container">
                                        <input type="number" id="endTimeHours" min="0" max="23" placeholder="16" class="time-hours" required>
                                        <span class="time-separator">:</span>
                                        <input type="number" id="endTimeMinutes" min="0" max="59" step="15" placeholder="00" class="time-minutes" required>
                                        <input type="hidden" id="endTime" name="endTime">
                                    </div>
                                    <small class="form-help">Minuttene må være hvert kvarter (00, 15, 30, 45)</small>
                                </div>
                                <div class="form-group">
                                    <label>Aktiviteter (velg en eller flere):</label>
                                    <div class="activity-checkboxes">
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Åpen for alle">
                                            <span class="color-dot" style="background-color: #98FB98;"></span>
                                            Åpen for alle
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Jeger">
                                            <span class="color-dot" style="background-color: #228B22;"></span>
                                            Jeger
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="DFS">
                                            <span class="color-dot" style="background-color: #FFFFFF; border: 1px solid #ddd;"></span>
                                            DFS
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Pistol">
                                            <span class="color-dot" style="background-color: #F59E0B;"></span>
                                            Pistol
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="PRS">
                                            <span class="color-dot" style="background-color: #8B5CF6;"></span>
                                            PRS
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Leirdue">
                                            <span class="color-dot" style="background-color: #EC4899;"></span>
                                            Leirdue
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Storviltprøve">
                                            <span class="color-dot" style="background-color: #3B82F6;"></span>
                                            Storviltprøve
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Annet">
                                            <span class="color-dot" style="background-color: #6B7280;"></span>
                                            Annet
                                        </label>

                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="Uavklart">
                                            <span class="color-dot" style="background-color: #EF4444;"></span>
                                            Uavklart
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="100m">
                                            <span class="color-dot" style="background-color: #87CEEB;"></span>
                                            100m
                                        </label>
                                        <label class="activity-checkbox">
                                            <input type="checkbox" name="activities" value="200m">
                                            <span class="color-dot" style="background-color: #4ECDC4;"></span>
                                            200m
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="comment">Kommentar:</label>
                                    <textarea id="comment" name="comment" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="rangeOfficer">Standsplassleder:</label>
                                    <input type="text" id="rangeOfficer" name="rangeOfficer">
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> Legg til
                                    </button>
                                    <button type="button" id="deleteActivityBtn" class="btn btn-danger" style="display: none;">
                                        <i class="fas fa-trash"></i> Slett
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="closeAdminModal()">
                                        <i class="fas fa-times"></i> Lukk
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Import Calendar Panel -->
                        <div id="importCalendarPanel" class="admin-panel">
                            <h4>Last inn ekstern kalender</h4>
                            <p>Hent aktiviteter fra Lorenskog Skytterlag's vaktplan-kalender.</p>
                            <div id="emptyDatabaseMessage" class="import-info" style="display: none;">
                                <div class="info-item">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Databasen er tom. Importer aktiviteter for å komme i gang.</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="importFromDate">Fra dato:</label>
                                <input type="date" id="importFromDate" name="importFromDate">
                            </div>
                            
                            <div class="form-group">
                                <label for="importToDate">Til dato:</label>
                                <input type="date" id="importToDate" name="importToDate">
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoCategorizeCheckbox" name="autoCategorize" checked>
                                    <span class="checkmark"></span>
                                    Auto-kategoriser basert på dato
                                </label>
                                <small class="form-help">Hvis avkrysset, kategoriseres aktiviteter automatisk basert på ukedag hvis ingen spesifikke aktiviteter er nevnt i kalenderen.</small>
                            </div>
                            
                            <div class="import-info">
                                <div class="info-item">
                                    <i class="fas fa-calendar"></i>
                                    <span>Kilde: Lorenskog Skytterlag Google Calendar</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Periode: <span id="importPeriodDisplay">Velg periode</span></span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-map"></i>
                                    <span>Mapping: Vaktplan → Aktivitetstyper</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button id="startImportBtn" class="btn btn-primary">
                                    <i class="fas fa-download"></i> Start import
                                </button>
                                <button id="closeAdminModalBtn" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Lukk
                                </button>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.8rem; color: #6c757d; text-align: center;">
                                (Import kan ta flere sekunder)
                            </p>
                            

                        </div>
                        
                        <!-- Check Duplicates Panel -->
                        <div id="checkDuplicatesPanel" class="admin-panel">
                            <h4>Sjekk for duplikater</h4>
                            <p>Finn og fjern duplikate aktiviteter basert på dato og tid.</p>
                            <div id="duplicatesResult" class="duplicates-result">
                                <p>Klikk "Sjekk duplikater" for å analysere dataene.</p>
                            </div>
                            <div class="form-actions">
                                <button id="checkDuplicatesBtn" class="btn btn-secondary">
                                    <i class="fas fa-search"></i> Sjekk duplikater
                                </button>
                                <button id="removeDuplicatesBtn" class="btn btn-danger hidden">
                                    <i class="fas fa-trash"></i> Fjern duplikater
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="closeAdminModal()">
                                    <i class="fas fa-times"></i> Lukk
                                </button>
                            </div>
                        </div>
                        

                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Activities Dialog -->
        <div id="deleteDialog" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-trash-alt"></i> Slett aktiviteter</h3>
                    <button class="modal-close" onclick="closeDeleteDialog()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Velg hvilke aktiviteter du vil slette:</p>
                    <div class="delete-options">
                        <button class="delete-option" onclick="deleteAllActivities()">
                            <i class="fas fa-trash-alt"></i>
                            <div class="delete-option-text">
                                <strong>Slett alle aktiviteter</strong>
                                <small>Fjerner alle aktiviteter fra databasen</small>
                            </div>
                        </button>
                        <button class="delete-option" onclick="deleteImportedActivities()">
                            <i class="fas fa-download"></i>
                            <div class="delete-option-text">
                                <strong>Slett alle importerte</strong>
                                <small>Fjerner kun aktiviteter importert fra kalender</small>
                            </div>
                        </button>
                        <button class="delete-option" onclick="deleteManualActivities()">
                            <i class="fas fa-edit"></i>
                            <div class="delete-option-text">
                                <strong>Slett alle manuelt lagt til</strong>
                                <small>Fjerner kun manuelt opprettede aktiviteter</small>
                            </div>
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeDeleteDialog()">
                        <i class="fas fa-times"></i> Avbryt
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script type="module">
        import { inject } from '@vercel/analytics';
        inject();
    </script>
</body>
</html> 